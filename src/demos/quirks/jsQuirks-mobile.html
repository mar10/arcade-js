<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'>
    <title>jsQuirks - Mobile</title>
    <!-- 
    <link href="../../depends/sample.css" rel="stylesheet" media="screen and (min-width:481px)">
    <link href="iphone.css" rel="stylesheet" media="only screen and (max-width:480px)">
     -->
    <link href="iphone.css" rel="stylesheet">
	<script src="../../depends/jquery.js" type="text/javascript"></script>
	<script src="../../depends/jquery.mousewheel.js" type="text/javascript"></script>

	<script src="../../lina.js/lina.js" type="text/javascript"></script>
    <script src="../../arcade.js/arcade.js" type="text/javascript"></script>
    <script src="../../arcade.js/arcade-controls.js" type="text/javascript"></script>

	<script src="jsQuirks.js" type="text/javascript"></script>

    <!-- Safari/iPhone: Display web content in full-screen mode: -->
<!-- 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <!-- Safari/iPhone: Hide status bar (requires full-screen mode) -->
<!-- 
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Safari/iPhone: Set fixed viewport -->
<!-- 
	<meta name="viewport" content="user-scalable = no, width = device-width">
    <!-- Safari/iPhone: Define App icon: -->
	<link rel="apple-touch-icon" href="apple-touch-icon.png">

	<script type="text/javascript"><!--
	// http://articles.sitepoint.com/article/iphone-development-12-tips/
	
	$(function(){
        $("#btnLandscape").click(function(){$("body").removeClass("portrait").addClass("landscape");});
        $("#btnPortrait").click(function(){$("body").removeClass("landscape").addClass("portrait");});
		var canvas = document.getElementById("canvas1");
		var game = new QuirksGame(canvas, {
			debug: {showFps: true}
			});
        // Add iPod extensions
        var stick = game.addObject(new TouchStick({
            pos: new Point2(60, canvas.height - 60),
            r1: 10,
            r2: 30
        }));
        var thrustSound = new AudioJS("thrust.wav");
        
        var btn1 = game.addObject(new TouchButton({
            pos: new Point2(canvas.width - 40, canvas.height - 40),
            r: 20,
            onClick: function(){
        	    thrustSound.play();
                if(this.game.quirk.color == "red")
                	this.game.quirk.color = "green";
                else
                	this.game.quirk.color = "red";
            }
        }));
        game.preStep = function(){
            var dx = -stick.getY(); 
            if(dx) {
                var f = 1 + (dx / 10); // [0.9 .. 1.1]
                if( f > 1 || game.quirk.velocity1.length() > 1)
                    game.quirk.velocity1.scale(f).limit(30);
                if( f > 1 || game.quirk.velocity2.length() > 1)
                    game.quirk.velocity2.scale(f).limit(30);
            }
            var dy = stick.getX(); 
            if((dy < 0 && game.quirk.maxLines > 2) || (dy > 0 && game.quirk.maxLines < 150))
                game.quirk.maxLines += dy;
            return true; 
        };
        game.onResize = function(e, width, height){
            game.debug("onResize: " + width + " x " + height);
            // Adjust controls that are relative to right or bottom border 
            stick.pos = new Point2(60, height - 60);
            btn1.pos = new Point2(width - 40, height - 40);
            // Let ArcadeGame adjust canvas size to new dimensions
            return true; 
        };
		// Evaluate orientation changes
        game.debug("bindong ooc: ");
        $(window).bind("orientationchange", function(e) {
//            game.debug("orientationchange: e=" + e);
            if(Math.abs(window.orientation) === 90){
                $("body").removeClass("portrait").addClass("landscape");
            }else{
                $("body").removeClass("landscape").addClass("portrait");
            }
            game.debug("orientationchange: class=" + $("body").attr("class") + ", e=" + e);
            // Scroll one pixel down, so Safari URL toolbar disappears
            setTimeout(scrollTo, 10, 0, 1);
        });
        if(window.orientation !== undefined)
            $(window).trigger("orientationchange");
	});
	--></script>
</head>
<body>
<!--
<div class="box">
     <h1>jsQuirks</h1>
    <a href="http://arcade-js.googlecode.com/">jsQuirks - iPhone edition</a>
</div>
-->
<audio id="clip" controls="false" preload="auto" src="thrust.mp3" autoplay="true">
           <source src="thrust.wav" type="audio/wave">
           <source src="thrust.mp3" type="audio/mpeg">
        </audio>

<div class="arcade-jsXXX">
</div>
<canvas id="canvas1" class="arcade-js">This game requires HTML 5 support.</canvas>
<button id="btnLandscape">Landscape</button>
<button id="btnPortrait">Portrait</button>
</body>
</html>
